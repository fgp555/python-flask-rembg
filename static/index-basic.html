<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Remove Background v2.0</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 2rem;
        background: #f7f7f7;
      }
      input,
      select {
        margin: 0.5rem;
        padding: 0.4rem;
      }
      img {
        max-width: 90%;
        margin-top: 1rem;
        border: 1px solid #ccc;
        border-radius: 8px;
      }
      .btn {
        margin: 1rem;
        padding: 0.6rem 1.2rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1rem;
      }
      .btn-primary {
        background-color: #007bff;
        color: white;
      }
      .btn-success {
        background-color: #28a745;
        color: white;
      }
      .loading {
        font-size: 1.2rem;
        color: #555;
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    <h1>Remove Background (API v2.0)</h1>

    <input type="file" id="fileInput" accept="image/png,image/jpeg,image/webp" /><br />

    <label>Formato:</label>
    <select id="format">
      <option value="png">PNG</option>
      <option value="jpeg">JPEG</option>
      <option value="webp">WEBP</option>
    </select>

    <label> <input type="checkbox" id="compress" /> Comprimir </label>

    <label> <input type="checkbox" id="resize" /> Redimensionar a 720px </label>
    <br />

    <button class="btn btn-primary" onclick="uploadImage()">Procesar</button>

    <div id="result"></div>

    <script>
      async function uploadImage() {
        const fileInput = document.getElementById("fileInput");
        const format = document.getElementById("format").value;
        const compress = document.getElementById("compress").checked;
        const resize = document.getElementById("resize").checked;

        if (!fileInput.files.length) {
          alert("Por favor, selecciona una imagen.");
          return;
        }

        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append("image_file", file);

        // Construir URL con parámetros
        const params = new URLSearchParams();
        params.append("format", format);
        if (compress) params.append("compress_image", "true");
        if (resize) params.append("max_width", "720");

        const url = `/v2.0/removebg?${params.toString()}`;

        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = `<p class="loading">⏳ Procesando imagen...</p>`;

        try {
          const response = await fetch(url, {
            method: "POST",
            headers: { "X-Api-Key": "MY_API_KEY" },
            body: formData,
          });

          if (!response.ok) {
            throw new Error(`Error: ${response.status} ${response.statusText}`);
          }

          const blob = await response.blob();
          const imgURL = URL.createObjectURL(blob);

          // Calcular tamaño en KB o MB
          const sizeKB = blob.size / 1024;
          const sizeText = sizeKB > 1024 ? (sizeKB / 1024).toFixed(2) + " MB" : sizeKB.toFixed(2) + " KB";

          resultDiv.innerHTML = `
          <h3>Resultado:</h3>
          <img src="${imgURL}" alt="Imagen sin fondo">
          <p><strong>Tamaño:</strong> ${sizeText}</p>
          <a href="${imgURL}" download="no-bg.${format}" class="btn btn-success">Descargar ${format.toUpperCase()}</a>
        `;
        } catch (error) {
          console.error(error);
          resultDiv.innerHTML = `<p style="color:red">⚠️ Error al procesar la imagen.</p>`;
        }
      }
    </script>
  </body>
</html>
